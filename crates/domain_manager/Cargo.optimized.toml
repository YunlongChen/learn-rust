# 极致优化打包体积的Cargo.toml配置示例
# 这个文件展示了如何最大程度减少二进制文件大小

[package]
name = "domain_manager"
version = "0.0.1"
edition = "2021"
authors = ["Your Name <your.email@example.com>"]
description = "Domain Manager - Optimized for minimal binary size"
license = "Mulan PSL v2"
repository = "https://stanic.xyz"
homepage = "https://stanic.xyz/"

# 极致优化的发布配置
[profile.release]
# 最高级别的大小优化
opt-level = "z"          # 优化大小而非速度
lto = true               # 链接时优化
codegen-units = 1        # 减少代码生成单元以获得更好的优化
panic = "abort"          # 移除panic展开代码
strip = true             # 移除调试符号

# 最小化的依赖配置
[dependencies]
# 核心功能依赖
anyhow = { version = "1.0", default-features = false }
base64 = { version = "0.22", default-features = false }
chrono = { version = "0.4", default-features = false, features = ["serde"] }
clap = { version = "4.5", default-features = false, features = ["std", "derive"] }
config = { version = "0.15", default-features = false }
confy = { version = "1.0", default-features = false }
directories = { version = "6.0", default-features = false }
domain_client = { path = "../domain_client" }

# GUI框架 - 最小化特性
iced = { version = "0.13", default-features = false, features = [
    "wgpu",              # 仅启用必要的渲染后端
    "tokio",             # 异步运行时
    "image",             # 图像支持
] }
iced_fontello = { version = "0.13", default-features = false }

# 图像处理 - 仅启用必要格式
image = { version = "0.25", default-features = false, features = [
    "png",               # 仅PNG格式
    "jpeg",              # 仅JPEG格式
] }

# 网络请求 - 最小化特性
reqwest = { version = "0.12", default-features = false, features = [
    "json",              # JSON支持
    "rustls-tls",        # 使用rustls而非native-tls
] }

# 数据库ORM - 最小化特性
sea-orm = { version = "2.0.0-rc.1", default-features = false, features = [
    "sqlx-sqlite",       # 仅SQLite支持
    "runtime-tokio-rustls", # 使用tokio和rustls
    "macros",            # 宏支持
] }
sea-orm-migration = { version = "2.0.0-rc.1", default-features = false, features = [
    "sqlx-sqlite",
    "runtime-tokio-rustls",
] }

# 序列化
serde = { version = "1.0", default-features = false, features = ["derive"] }
serde_json = { version = "1.0", default-features = false }

# 异步运行时 - 最小化特性
tokio = { version = "1.46", default-features = false, features = [
    "rt-multi-thread",   # 多线程运行时
    "macros",            # 宏支持
    "time",              # 时间功能
] }

# 日志 - 最小化
tracing = { version = "0.1", default-features = false }
tracing-subscriber = { version = "0.3", default-features = false, features = ["fmt"] }

# 其他必要依赖
toml = { version = "0.9", default-features = false }
uuid = { version = "1.17", default-features = false, features = ["v4", "serde"] }
percent-encoding = { version = "2.3", default-features = false }
secrecy = { version = "0.10", default-features = false }

# 移除的大型依赖（如果不是必需的）:
# cloudflare = "0.14.0"     # 如果不使用Cloudflare API
# maxminddb = "0.26.0"      # 如果不需要GeoIP
# plotters = "0.3.7"        # 如果不需要图表
# rust-i18n = "3.1.5"       # 如果不需要国际化
# rand = "0.9.1"            # 如果不需要随机数
# num_cpus = "1.17.0"       # 如果不需要CPU信息

[build-dependencies]
winres = { version = "0.1", default-features = false }

[dev-dependencies]
serde_test = { version = "1.0", default-features = false }
serial_test = { version = "3.2", default-features = false }

# 优化特定目标平台
[target.'cfg(windows)'.dependencies]
# Windows特定的最小化依赖

# 排除不必要的文件
[package.metadata.wix]
exclude = [
    "*.pdb",             # 调试符号
    "*.map",             # 映射文件
    "docs/*",            # 文档
    "examples/*",        # 示例
    "tests/*",           # 测试文件
]

# Cargo特性优化
[features]
default = ["minimal"]
minimal = []              # 最小功能集
full = [                  # 完整功能集（开发时使用）
    "cloudflare",
    "geoip",
    "charts",
    "i18n",
]
cloudflare = []
geoip = []
charts = []
i18n = []